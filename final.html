<!DOCTYPE html>
<html lang="en">
<head>
    <title>Personal Budget Management</title>
    <link rel="stylesheet" href="finalexam.css" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
     function submitForm() {
    // get form fields
    var date = document.getElementById("date").value.trim();
    var firstName = document.getElementById("first_name").value.trim();
    var lastName = document.getElementById("last_name").value.trim();
    var totalIncome = document.getElementById("total_income").value.trim();
    var expenseName = document.getElementById("expense_name").value.trim();
    var amount = document.getElementById("amount").value.trim();

// validate form fields
if (date === "" || firstName === "" || lastName === "" || totalIncome === "" || expenseName === "" || amount === "") {
    alert("Please fill in all fields.");
    return;
}

if (isNaN(parseFloat(totalIncome))) {
    alert("Please enter a valid monthly income.");
    return;
}

if (isNaN(parseFloat(amount)) || parseFloat(amount) < 0) {
    alert("Please enter a valid expense amount.");
    return;
}

// send form data and sort option
var xhttp = new XMLHttpRequest();
var formData = new FormData(document.querySelector('form'));
var sortOption = document.querySelector('input[name="sort-by"]:checked');
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        document.getElementById("results").innerHTML = this.responseText;
    }
};
xhttp.open("POST", "final.php", true);
xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhttp.send(new FormData(document.querySelector('form')));

}

// add event listeners to radio buttons
var sortByMonth = document.getElementById("sort-by-month");
var sortByYear = document.getElementById("sort-by-year");
sortByMonth.addEventListener("click", submitForm);
sortByYear.addEventListener("click", submitForm);

// add event listener to submit button
var submitButton = document.getElementById("submit-button");
submitButton.addEventListener("click", submitForm);
</script>
</head>
<body>
    <h2>Introduction</h2>
    <p>This is a very basic personal budget management program that helps users manage their personal finances. This program will allow the user to add their monthly income, add expenses, and track expenses over time. Please use the inputs below to enter your information. When you're done, hit the submit button to see how well you're managing your budget, or if you need to start saving some money!</p>
    <form method="POST" action="final.php">
        <label for="date">Enter the date of the expense (YYYY-MM-DD):</label>
        <input type="date" id="date" name="date" required><br><br>

            <label for="first_name">First Name:</label>
    <input type="text" id="first_name" name="first_name" required><br><br>

    <label for="last_name">Last Name:</label>
    <input type="text" id="last_name" name="last_name" required><br><br>
	
	<label for="total_income">Total Monthly Income:</label>
	<input type="number" id="total_income" name="total_income" required><br><br>

    <label for="expense_name">Expense:</label>
    <input type="text" id="expense_name" name="expense_name" required><br><br>

    <label for="amount">Amount:</label>
    <input type="number" id="amount" name="amount" min="0" step="0.01" required><br><br>

<br><br>
<button type="button" id="submit-button">Submit</button>
<br><br>
</form>

<?php if (isset($results) && !empty($results)): ?>
<h2>Results</h2>
<!-- Add the radio buttons for sorting -->
<form action="final.php" method="get">
    <label for="first_name">First Name:</label>
    <input type="text" name="first_name" id="first_name" value="<?= $first_name ?>">
    <label for="last_name">Last Name:</label>
    <input type="text" name="last_name" id="last_name" value="<?= $last_name ?>">
    <br>
    <label for="month">Filter by Month:</label>
    <select name="month" id="month">
        <option value="">All Months</option>
        <option value="1" <?= $month === '1' ? 'selected' : '' ?>>January</option>
        <option value="2" <?= $month === '2' ? 'selected' : '' ?>>February</option>
        <option value="3" <?= $month === '3' ? 'selected' : '' ?>>March</option>
        <option value="4" <?= $month === '4' ? 'selected' : '' ?>>April</option>
        <option value="5" <?= $month === '5' ? 'selected' : '' ?>>May</option>
        <option value="6" <?= $month === '6' ? 'selected' : '' ?>>June</option>
        <option value="7" <?= $month === '7' ? 'selected' : '' ?>>July</option>
        <option value="8" <?= $month === '8' ? 'selected' : '' ?>>August</option>
        <option value="9" <?= $month === '9' ? 'selected' : '' ?>>September</option>
        <option value="10" <?= $month === '10' ? 'selected' : '' ?>>October</option>
		<option value="11" <?= $month === '11' ? 'selected' : '' ?>>November</option>
		<option value="12" <?= $month === '12' ? 'selected' : '' ?>>December</option>
    </select>
    <label for="year">Filter by Year:</label>
    <select name="year" id="year">
        <option value="">All Years</option>
        <?php foreach ($years as $y): ?>
            <option value="<?= $y ?>" <?= $year === $y ? 'selected' : '' ?>><?= $y ?></option>
        <?php endforeach; ?>
    </select>
    <button type="submit">Submit</button>
</form>

<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Income</th>
            <th>Expense</th>
			<th>Amount</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($expenses as $expense): ?>
            <tr>
                <td><?= $expense['date'] ?></td>
                <td><?= $expense['total_income'] ?></td>
                <td><?= $expense['expense_name'] ?></td>
				<td><?= $expense['amount'] ?></td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>
    <?php endif; ?>
    <br>
    <p>You have spent $<?= $results['total_expenses'] ?> in <?= $results['num_months'] ?> month(s) and <?= $results['num_years'] ?> year(s).</p>
</div>
<br>
</body>
</html>
